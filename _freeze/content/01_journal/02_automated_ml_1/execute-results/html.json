{
  "hash": "dc657fa41a4c81fdb036ead40c901ebe",
  "result": {
    "markdown": "---\ntitle: \"Automated Machine Learning with H2O (I)\"\nauthor: \"Adrian Florea\"\n---\n\n\n# Challenge 3 - Investigate features and answer questions\n\n## Prepare data and functions\n\n\n::: {.cell hash='02_automated_ml_1_cache/html/unnamed-chunk-1_857fcfb6a1f01f2c5483a23ad83fcdd5'}\n\n```{.r .cell-code}\n# Libraries \nlibrary(tidyverse)\nlibrary(readxl)\nlibrary(skimr)\nlibrary(GGally)\n\n# Load Data data definitions\n\npath_data_definitions <- \"~/GitHub/ss24-bdml-Adrian-0402/source_data/automated/data_definitions.xlsx\"\ndefinitions_raw_tbl   <- read_excel(path_data_definitions, sheet = 1, col_names = FALSE)\n\nemployee_attrition_tbl <- read_csv(\"~/GitHub/ss24-bdml-Adrian-0402/source_data/automated/datasets-1067-1925-WA_Fn-UseC_-HR-Employee-Attrition.csv\")\n\n# Step 1: Data Summarization -----\n\n# skim(employee_attrition_tbl)\n# We had a look at this before\n\n# Step 2: Data Visualization ----\n\n# Helper function\ncount_to_pct <- function(data, ..., col = n) {\n  \n  # capture the dots\n  grouping_vars_expr <- quos(...)\n  col_expr <- enquo(col)\n  \n  ret <- data %>%\n    group_by(!!! grouping_vars_expr) %>%\n    mutate(pct = (!! col_expr) / sum(!! col_expr)) %>%\n    ungroup()\n  \n  return(ret)\n  \n}\n\n# Plot function\nplot_ggpairs <- function(data, color = NULL, density_alpha = 0.5) {\n  \n  color_expr <- enquo(color)\n  \n  if (rlang::quo_is_null(color_expr)) {\n    \n    g <- data %>%\n      ggpairs(lower = \"blank\") \n    \n  } else {\n    \n    color_name <- quo_name(color_expr)\n    \n    g <- data %>%\n      ggpairs(mapping = aes_string(color = color_name), \n              lower = \"blank\", legend = 1,\n              diag = list(continuous = wrap(\"densityDiag\", \n                                            alpha = density_alpha))) +\n      theme(legend.position = \"bottom\")\n  }\n  \n  return(g)\n  \n}\n```\n:::\n\n\n## Question 1:\n\n\n::: {.cell hash='02_automated_ml_1_cache/html/unnamed-chunk-2_e0f5ec58c33c6bb0e24faaca6d714242'}\n\n```{.r .cell-code}\nemployee_attrition_tbl %>% \n  select(Attrition,MonthlyIncome) %>% \n  plot_ggpairs(Attrition)\n```\n\n::: {.cell-output-display}\n![](02_automated_ml_1_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\nWe can see a strong peak for \"Yes\" at lower monthly incomes.\nTherefore, those that are leaving have a lower monthly income <span style=\"color:red\">**(c)**</span>.\n\n## Question 2:\n\n\n::: {.cell hash='02_automated_ml_1_cache/html/unnamed-chunk-3_25dda2bbaf73c6dffce736feb54a1bdc'}\n\n```{.r .cell-code}\nemployee_attrition_tbl %>% \n  select(Attrition,PercentSalaryHike) %>% \n  plot_ggpairs(Attrition)\n```\n\n::: {.cell-output-display}\n![](02_automated_ml_1_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\nThe Boxplot shows very similar median values of the salary hike.\nThe density plot shows us a mostly overlapping behavior with minor\ndifferences in the distribution. Thus it is not entirely clear\nto deduce anything based on just the Percent Salary Hike <span style=\"color:red\">**(d)**</span>.\n\n## Question 3:\n\n\n::: {.cell hash='02_automated_ml_1_cache/html/unnamed-chunk-4_da0fb6c25ac31efe5ef82b7343fc4c5c'}\n\n```{.r .cell-code}\nemployee_attrition_tbl %>% \n  select(Attrition,StockOptionLevel) %>% \n  plot_ggpairs(Attrition)\n```\n\n::: {.cell-output-display}\n![](02_automated_ml_1_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\nHere we can confidently say that the density for higher stock options\n(1 and 2) is higher for those that are staying (Attrition: \"No\").\nTherefore, those that are staying have a higher stock option level <span style=\"color:red\">**(b)**</span>.\n\n## Question 4:\n\n\n::: {.cell hash='02_automated_ml_1_cache/html/unnamed-chunk-5_2eeac721f297b57fff79c73fdd609072'}\n\n```{.r .cell-code}\nemployee_attrition_tbl %>% \n  select(Attrition,EnvironmentSatisfaction) %>% \n  plot_ggpairs(Attrition)\n```\n\n::: {.cell-output-display}\n![](02_automated_ml_1_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\nOne can see that for higher satisfaction levels, significantly more\npeople are staying. This in turn means, that a higher proportion of those\nthat are leaving have a lower satisfaction level, especially for 1 (=\"low\").\nIt is also visible on the boxplot, because for \"Yes\" attrition, the lower 25% quantile\nextends to 1.\nSo in summary: A higher proportion of those leaving have a low environment satisfaction level <span style=\"color:red\">**(a)**</span>.\n\n## Question 5:\n\n\n::: {.cell hash='02_automated_ml_1_cache/html/unnamed-chunk-6_7f2bf24ef1cbc99063cc223e81792a99'}\n\n```{.r .cell-code}\nemployee_attrition_tbl %>% \n  select(Attrition,WorkLifeBalance) %>% \n  plot_ggpairs(Attrition)\n```\n\n::: {.cell-output-display}\n![](02_automated_ml_1_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\nLooking at the densities again, we can see that the 2's and 3's of people that are\nstaying are significantly higher <span style=\"color:red\">**(b)**</span>.\n\n## Question 6:\n\n\n::: {.cell hash='02_automated_ml_1_cache/html/unnamed-chunk-7_73bf48bac60ed8f301c10582cad9ea12'}\n\n```{.r .cell-code}\nemployee_attrition_tbl %>%\n  select(Attrition,JobInvolvement) %>%\n  plot_ggpairs(Attrition)\n```\n\n::: {.cell-output-display}\n![](02_automated_ml_1_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\nThe density plot shows, that the 3's and 4's are much more present for people that\nare staying (especially visible for 3's). In turn this means, that hose that are leaving\nhave a lower density of 3's and 4's <span style=\"color:red\">**(a)**</span>.\n\n## Question 7:\n\n\n::: {.cell hash='02_automated_ml_1_cache/html/unnamed-chunk-8_c140b70132e4e99a7848d59c5a3e54a8'}\n\n```{.r .cell-code}\nemployee_attrition_tbl %>%\n  select(Attrition,OverTime) %>%\n  plot_ggpairs(Attrition)\n```\n\n::: {.cell-output-display}\n![](02_automated_ml_1_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\nHere we can see that for people who are leaving, the relative proportion compared\nto those not leaving is higher when looking at those working overtime. The absolute numbers\nfor attrition is almost the same for either working overtime or not. But for people who are staying its visibly lower. We look at it from another perspective by computing concrete numbers:\n\n::: {.cell hash='02_automated_ml_1_cache/html/unnamed-chunk-9_de2b6909b482c7b0b29716db0320d7c3'}\n\n```{.r .cell-code}\nemployee_attrition_tbl %>%\n  count(OverTime, Attrition) %>%\n  count_to_pct(OverTime)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"OverTime\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"Attrition\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"n\"],\"name\":[3],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"pct\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"No\",\"2\":\"No\",\"3\":\"944\",\"4\":\"0.8956357\"},{\"1\":\"No\",\"2\":\"Yes\",\"3\":\"110\",\"4\":\"0.1043643\"},{\"1\":\"Yes\",\"2\":\"No\",\"3\":\"289\",\"4\":\"0.6947115\"},{\"1\":\"Yes\",\"2\":\"Yes\",\"3\":\"127\",\"4\":\"0.3052885\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n30% of people who are working overtime are leaving. Only 10% of people\nwho are not working overtime are leaving.\nOr if you change the perspective one more time:\n\n::: {.cell hash='02_automated_ml_1_cache/html/unnamed-chunk-10_575f4a2e21e413c9234ad8e87e4d1cd4'}\n\n```{.r .cell-code}\nemployee_attrition_tbl %>%\n  count(Attrition, OverTime) %>%\n  count_to_pct(Attrition)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"Attrition\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"OverTime\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"n\"],\"name\":[3],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"pct\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"No\",\"2\":\"No\",\"3\":\"944\",\"4\":\"0.7656123\"},{\"1\":\"No\",\"2\":\"Yes\",\"3\":\"289\",\"4\":\"0.2343877\"},{\"1\":\"Yes\",\"2\":\"No\",\"3\":\"110\",\"4\":\"0.4641350\"},{\"1\":\"Yes\",\"2\":\"Yes\",\"3\":\"127\",\"4\":\"0.5358650\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n54% of people who are leaving are working overtime. Only 23% who are staying are\nworking overtime.\n\nOverall you can say generally, that the proportion of those leaving that are working overtime\nare high compared to those that are not leaving <span style=\"color:red\">**(a)**</span>. (Unless you would say that working overtime\nshall result in more attrition)\n\n## Question 8:\n\n\n::: {.cell hash='02_automated_ml_1_cache/html/unnamed-chunk-11_01b21fe0590a8df6185c077c498af30f'}\n\n```{.r .cell-code}\nemployee_attrition_tbl %>%\n  select(Attrition,TrainingTimesLastYear) %>%\n  plot_ggpairs(Attrition)\n```\n\n::: {.cell-output-display}\n![](02_automated_ml_1_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\nIn the plot we can see, that for most higher numbers of training times\n(2, 3, 5 and 6), the density of those staying is significantly higher.\nIn the boxplot we can also see, that the median for leaving is 2, while it is 3 \nfor those who stay. Therefore we can say that people that leave tend \nto have less annual trainings <span style=\"color:red\">**(b)**</span>.\n\n## Question 9:\n\n\n::: {.cell hash='02_automated_ml_1_cache/html/unnamed-chunk-12_208cafc0b78094b9f2cbab4a2c9351e9'}\n\n```{.r .cell-code}\nemployee_attrition_tbl %>%\n  select(Attrition,YearsAtCompany) %>%\n  plot_ggpairs(Attrition)\n```\n\n::: {.cell-output-display}\n![](02_automated_ml_1_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\nThe density plot shows a higher concentration of people who are leaving that have\nless years at the company (around 0 to 3). After that, people tend to stay more.\nThe boxplot again confirms this, as the quantiles from the people leaving contain lower values.\nTherefore, people that leave tend to have less working years at the company <span style=\"color:red\">**(b)**</span>.\n\n## Question 10:\n\n\n::: {.cell hash='02_automated_ml_1_cache/html/unnamed-chunk-13_ead9642617922a4248386ddeb47afde9'}\n\n```{.r .cell-code}\nemployee_attrition_tbl %>%\n  select(Attrition,YearsSinceLastPromotion) %>%\n  plot_ggpairs(Attrition)\n```\n\n::: {.cell-output-display}\n![](02_automated_ml_1_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\nOnce again the density plot shows, that a slight but a visible amount of people\nthat are leaving have a higher density for fewer years since their last promotion.\nHowever, we have seen before that also more people tend to leave that have\nfewer working years in general, so they were probably never promoted since they just started.\nThere is some sort of correlation, so based on just this plot we cannot make a\nclear statement <span style=\"color:red\">**(c)**</span>.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}